<h1><%= @product.title %></h1>
<p><%= @product.description %><p>
<p><%= @product.price %><p>
<p><%= @product.category_id %></p>
<p><%= @product.user.first_name %></p>


<% if user_signed_in? && (can? :favourite, @product)%>
  <% if !@product.favourite_by?(current_user) %>
    <%= link_to fa_icon("thumbs-o-up"), product_favourites_path(@product), method: :post%>
  <% else %>
    <%= link_to fa_icon("thumbs-up"),  product_favourite_path(@product, @product.favourite_for(current_user)), method: :delete %>
    <span><%= pluralize(@product.favourites.count, 'favourite') %></span>
  <% end %>
<% end %>


<% if can? :edit, @product%>
  <%= link_to 'Edit', edit_product_path(@product) %>
<% end %>

<%# Rails enables us to make links end non-GET requests by setting the `method`
    attribute for `link_to`. Rails uses Javascript to accomplish that. %>
<% if can? :destroy, @product%>
  <%= link_to 'Delete', product_path(@product), method: :delete, data:{confirm: 'Are you sure?'} %>
<% end %>
<hr>

<%# @review.errors.full_messages.join(', ') %>

<h2>Reviews</h2>
<%= form_for [@product, @review] do |f| %>
  <p>Comment:</p>
  <%= f.text_area :body, {class: "form-control"} %>
  <p>Rating:</p>
  <%# f.text_area :rating %>
  <%= f.select :rating, [1,2,3,4,5] %>
  <br>
  <br>
  <%= f.submit %>
<% end %>

<hr>
<% @product.reviews.each do |r| %>

  <p><%= r.body  %></p>
  <p><%= r.user.first_name %></p>
  <p>Rating: <%= r.rating %></p>
  <p><%= r.body %></p>


  <% if user_signed_in? && (can? :like, r)%>
    <% if !r.liked_by?(current_user) %>
      <%= link_to fa_icon("heart-o"), review_likes_path(r), method: :post%>
    <% else %>
      <%= link_to fa_icon("heart"), like_path(r.like_for(current_user)), method: :delete %>
      <span><%= pluralize(r.likes.count, 'like') %></span>
    <% end %>
  <% end %>


  <% if can? :destroy, r%>
    <%# link_to 'Delete review', product_review_path(@product, r), method: :delete, data:{confirm: "Are your sure?"} %>
    <%= link_to 'Delete review', review_path(r), method: :delete, data:{confirm: "Are your sure?"} %>
  <% end %>

  <hr>



<% end %>
